# Реализация библиотеки s21_decimal

## О проекте

Проект представляет собой реализацию библиотеки `s21_decimal.h` на языке C, которая добавляет поддержку типа `decimal` для финансовых вычислений с фиксированной точкой. Библиотека обеспечивает высокоточные арифметические операции без погрешностей, свойственных типам с плавающей точкой.

## Особенности реализации

### Двоичное представление

Тип `s21_decimal` реализован как структура:
```c
typedef struct {
    int bits[4];
} s21_decimal;
```

- `bits[0]`, `bits[1]`, `bits[2]`: младшие, средние и старшие 32 бита 96-битного целого числа
- `bits[3]`: 
  - Биты 0-15: не используются (0)
  - Биты 16-23: показатель степени (0-28)
  - Биты 24-30: не используются (0)
  - Бит 31: знак (0 - положительный, 1 - отрицательный)

### Поддерживаемый диапазон
- От -79,228,162,514,264,337,593,543,950,335
- До +79,228,162,514,264,337,593,543,950,335

## Реализованные функции

### Арифметические операции
| Функция | Описание | Коды ошибок |
|--------|----------|-------------|
| `s21_add()` | Сложение | 0 - OK, 1 - переполнение, 2 - отрицательное переполнение |
| `s21_sub()` | Вычитание | 0 - OK, 1 - переполнение, 2 - отрицательное переполнение |
| `s21_mul()` | Умножение | 0 - OK, 1 - переполнение, 2 - отрицательное переполнение |
| `s21_div()` | Деление | 0 - OK, 1 - переполнение, 2 - отрицательное переполнение, 3 - деление на 0 |

*При переполнении используется банковское округление*

### Операции сравнения
| Функция | Описание | Возвращаемое значение |
|---------|----------|------------------------|
| `s21_is_less()` | Меньше (<) | 0 - FALSE, 1 - TRUE |
| `s21_is_less_or_equal()` | Меньше или равно (<=) | 0 - FALSE, 1 - TRUE |
| `s21_is_greater()` | Больше (>) | 0 - FALSE, 1 - TRUE |
| `s21_is_greater_or_equal()` | Больше или равно (>=) | 0 - FALSE, 1 - TRUE |
| `s21_is_equal()` | Равно (==) | 0 - FALSE, 1 - TRUE |
| `s21_is_not_equal()` | Не равно (!=) | 0 - FALSE, 1 - TRUE |

### Преобразования
| Функция | Описание | Коды ошибок |
|---------|----------|-------------|
| `s21_from_int_to_decimal()` | int → decimal | 0 - OK, 1 - ошибка |
| `s21_from_float_to_decimal()` | float → decimal | 0 - OK, 1 - ошибка (вне диапазона) |
| `s21_from_decimal_to_int()` | decimal → int | 0 - OK, 1 - ошибка (дробная часть отбрасывается) |
| `s21_from_decimal_to_float()` | decimal → float | 0 - OK, 1 - ошибка |

*Особенности преобразования float:*
- Числа с |x| < 1e-28 → ошибка
- Числа с |x| > max_decimal → ошибка
- Более 7 значащих цифр → округление

### Дополнительные функции
| Функция | Описание | Коды ошибок |
|---------|----------|-------------|
| `s21_floor()` | Округление к -∞ | 0 - OK, 1 - ошибка |
| `s21_round()` | Округление к ближайшему целому | 0 - OK, 1 - ошибка |
| `s21_truncate()` | Отбрасывание дробной части | 0 - OK, 1 - ошибка |
| `s21_negate()` | Умножение на -1 | 0 - OK, 1 - ошибка |

## Технические характеристики

- **Стандарт языка**: C11
- **Компилятор**: gcc
- **Стиль кода**: Google Style
- **Сборка**: Статическая библиотека `s21_decimal.a`
- **Покрытие тестами**: >80% для каждой функции
- **Зависимости**: Библиотека Check для unit-тестов
- **Ограничения**: 
  - Запрещено использование `__int128`
  - Поддержка чисел в указанном диапазоне
  - POSIX-совместимая реализация

## Сборка и тестирование

### Сборка библиотеки
```bash
make s21_decimal.a
```

### Запуск unit-тестов
```bash
make test
```

### Генерация отчета о покрытии
```bash
make gcov_report
```

### Очистка артефактов
```bash
make clean
```

### Запуск тестов через Docker
[Информацию можно найти в этом файле](launch.md)

## Примеры использования

```c
#include "s21_decimal.h"

s21_decimal a, b, result;
s21_from_int_to_decimal(5, &a);
s21_from_int_to_decimal(3, &b);

// Сложение
s21_add(a, b, &result);

// Сравнение
if (s21_is_greater(a, b)) {
    // ...
}

// Преобразование
float f;
s21_from_decimal_to_float(result, &f);
```

## Архитектурные решения

1. **Эффективное хранение**:
   - 128-битная структура (96 бит мантисса + 32 бит служебная информация)
   - Побитовые операции для доступа к компонентам

2. **Точные вычисления**:
   - Операции с целочисленной мантиссой
   - Нормализация показателей степени
   - Банковское округление

3. **Обработка граничных значений**:
   - Контроль переполнения
   - Обработка деления на ноль
   - Специальные случаи преобразований

4. **Оптимизация производительности**:
   - Битовая арифметика
   - Минимизация операций копирования
   - Эффективные алгоритмы округления

## Авторы

- Aglet Craitbla ([GitHub](https://github.com/Craitbla))
- Daniil Karaulov dksss ([GitHub](https://github.com/dksss))
- Данил Geronimo112263 ([GitHub](https://github.com/Geronimo112263))